var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
var Engine=function(a,b){this.game=a;this.ctx=b.getContext("2d");this.width=b.width;this.height=b.height;this.generator=new Generator;this.mousedown=!1;this.scale=30;this.dragy=this.dragx=this.offsety=this.offsetx=0;b.onmousedown=this.onmousedown.bind(this);b.onmouseup=this.onmouseup.bind(this);b.onmousemove=this.onmousemove.bind(this);b.onmousewheel=this.onmousewheel.bind(this);b.tabIndex=1};
Engine.prototype.onmousedown=function(a){this.mousedown=!0;this.dragx=this.offsetx-a.clientX;this.dragy=this.offsety-a.clientY};Engine.prototype.onmouseup=function(a){this.mousedown&&!1!==this.game.centerUnit&&0==a.button&&this.game.units[this.game.centerUnit].waypoint(this,a.clientX,a.clientY);this.mousedown=!1};Engine.prototype.onmousemove=function(a){this.mousedown&&(this.offsetx=this.dragx+a.clientX,this.offsety=this.dragy+a.clientY);return!1};
Engine.prototype.onmousewheel=function(a){var b=0;0>a.deltaY&&100>this.scale&&(b=2);0<a.deltaY&&4<this.scale&&(b=-2);this.offsetx-=(a.clientX-this.offsetx)/this.scale*b;this.offsety-=(a.clientY-this.offsety)/this.scale*b;this.scale+=b;return!1};Engine.prototype.centerUnit=function(a){a=this.transform(a);this.offsetx+=this.width/2-a[0];this.offsety+=this.height/2-a[1]};
Engine.prototype.transform=function(a,b){b=void 0===b?!1:b;!1===b&&(b=a.y,a=a.x);a*=this.scale;b*=this.scale;a+=this.offsetx;b+=this.offsety;return[a,b]};Engine.prototype.px=function(a){return a/30};Engine.prototype.rectangle=function(a,b,c,d,e,f){e=void 0===e?"black":e;f=void 0===f?!1:f;a=this.transform(a,b);!1!==e&&(this.ctx.strokeStyle=e,this.ctx.strokeRect(a[0],a[1],c*this.scale,d*this.scale));!1!==f&&(this.ctx.fillStyle=f,this.ctx.fillRect(a[0],a[1],c*this.scale,d*this.scale))};
Engine.prototype.circle=function(a,b,c,d,e){d=void 0===d?"black":d;e=void 0===e?!1:e;a=this.transform(a,b);c*=this.scale;!1!==d&&(this.ctx.strokeStyle=d,this.ctx.beginPath(),this.ctx.arc(a[0],a[1],c,2*Math.PI,!1),this.ctx.stroke());!1!==e&&(this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(a[0],a[1],c,2*Math.PI,!1),this.ctx.fill())};
Engine.prototype.redraw=function(a){this.ctx.beginPath();this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);a.render(this);a=$jscomp.makeIterator(this.game.units);for(var b=a.next();!b.done;b=a.next())b.value.think()};var Game=function(a){this.canvas=a;this.engine=new Engine(this,a);this.layer=new Layer;this.units=[];this.units.push(new Player(this.layer,this.engine.generator,2,2));this.centerUnit=0;this.fps=1E3/60;this.then=0;window.requestAnimationFrame(this.loop.bind(this))};Game.prototype.indexunit=function(a){this.centerUnit=a;this.engine.centerUnit(this.units[this.centerUnit])};
Game.prototype.loop=function(){var a=Date.now(),b=a-this.then;b>this.fps&&(this.then=a-b%this.fps,this.engine.centerUnit(this.units[this.centerUnit]),this.engine.redraw(this.layer),this.canvas.focus(),this.units[this.centerUnit].draw(this.engine));window.requestAnimationFrame(this.loop.bind(this))};var Player=function(a,b,c,d){this.layer=a;this.waypoints=[];this.x=c;this.y=d;this.speed=.05;this.angle=!1;this.skin=b.pick(["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"]);this.weight=b.randomBetween(67,120);this.height=b.randomBetween(150,200)};Player.prototype.waypoint=function(a,b,c){var d=a.transform(this.x,this.y);this.angle=180/Math.PI*Math.atan2(c-d[1],b-d[0]);this.waypoints=[[this.x,this.y,(b-a.offsetx)/a.scale,(c-a.offsety)/a.scale]]};
Player.prototype.arrived=function(a){var b=a[2]-a[0],c=a[3]-a[1];return 0<b&&this.x>a[2]||0>b&&this.x<a[2]||0<c&&this.y>a[3]||0>c&&this.y<a[3]?!0:!1};
Player.prototype.collide=function(){for(var a=!1,b=!1,c=!1,d=$jscomp.makeIterator(this.layer.blocks.blocks),e=d.next();!e.done;e=d.next()){a=e.value;b=a.x*a.width;c=a.y*a.height;e=a.x*a.width+a.width;var f=a.y*a.height+a.height;if(this.x>b&&this.x<e&&this.y>c&&this.y<f)break}d=$jscomp.makeIterator(a.contents);for(e=d.next();!e.done;e=d.next())if(e=e.value,"white"==e[6]){f=b+e[1];var g=c+e[2],h=f+e[3],k=g+e[4];this.x>f&&this.x<h&&this.y>g&&this.y<k&&console.log(e,a)}};
Player.prototype.think=function(){if(!1!==this.angle){var a=this.x+Math.cos(this.angle*Math.PI/180)*this.speed,b=this.y+Math.sin(this.angle*Math.PI/180)*this.speed;this.collide();this.x=a;this.y=b;this.arrived(this.waypoints[0])&&(this.angle=!1,this.waypoints.shift())}};Player.prototype.draw=function(a){a.rectangle(this.x-a.px(5),this.y-a.px(10),a.px(10),a.px(20),"black","#333");a.circle(this.x,this.y-a.px(18),a.px(8),"black",this.skin)};var Block=function(a,b,c,d,e){this.x=b;this.y=c;this.width=d;this.height=e;b=b*b+c*c;this.contents=[];this.contents.push(["rectangle",0,0,!1,!1,!1,"green"]);200>b&&(this.contents.push(["rectangle",0,0,!1,4,!1,"grey"]),this.contents.push(["rectangle",0,0,4,!1,!1,"grey"]));180>b&&(this.contents.push(["rectangle",4,4,1,17,!1,"lightgrey"]),this.contents.push(["rectangle",4,4,17,1,!1,"lightgrey"]),this.contents.push(["rectangle",20,4,1,17,!1,"lightgrey"]),this.contents.push(["rectangle",4,20,17,1,!1,"lightgrey"]));
170>b&&(a=a.pick("park alleys tower alleys tower alleys".split(" ")),"tower"==a?this.contents.push(["rectangle",5,5,15,15,"black","white"]):"alleys"==a&&(this.contents.push(["rectangle",5,12,15,1,!1,"grey"]),this.contents.push(["rectangle",12,5,1,15,!1,"grey"]),this.contents.push(["rectangle",5,5,7,7,"black","white"]),this.contents.push(["rectangle",13,5,7,7,"black","white"]),this.contents.push(["rectangle",5,13,7,7,"black","white"]),this.contents.push(["rectangle",13,13,7,7,"black","white"])))};
Block.prototype.draw=function(a){for(var b=$jscomp.makeIterator(this.contents),c=b.next();!c.done;c=b.next())c=c.value,a[c[0]](this.x*this.width+c[1],this.y*this.height+c[2],!1===c[3]?this.width:c[3],!1===c[4]?this.height:c[4],c[5],c[6])};var Blocks=function(a,b){this.blocks=[];this.width=a;this.height=b;this.drawn=this.created=0};Blocks.prototype.exists=function(a,b){for(var c in this.blocks)if(this.blocks[c].x==a&&this.blocks[c].y==b)return this.blocks[c];return!1};Blocks.prototype.retrieve=function(a,b,c){var d=this.exists(b,c);!1===d&&(d=new Block(a,b,c,this.width,this.height),this.blocks.push(d),this.created++);return d};var Layer=function(){this.blockheight=this.blockwidth=21;this.blocks=new Blocks(this.blockwidth,this.blockheight)};
Layer.prototype.render=function(a){this.blocks.created=this.blocks.drawn=0;for(var b=Math.floor(-a.offsetx/a.scale/this.blockwidth),c=Math.floor(-a.offsety/a.scale/this.blockheight),d=Math.ceil(a.ctx.canvas.width/a.scale/this.blockwidth),e=Math.ceil(a.ctx.canvas.height/a.scale/this.blockheight),f=b;f<=b+d;++f)for(var g=c;g<=c+e;++g)this.blocks.retrieve(a.generator,f,g).draw(a),this.blocks.drawn++;0<this.blocks.created&&console.log(this.blocks)};var Generator=function(){this.seed=100*Math.random()};Generator.prototype.random=function(){var a=12345*Math.sin(this.seed++);return a-Math.floor(a)};Generator.prototype.randomBetween=function(a,b){return Math.floor(this.random()*(b-a+1)+a)};Generator.prototype.pick=function(a){var b=Math.floor(this.random()*a.length);return a[b]};window.onload=function(){var a=document.getElementById("viewport");window.onresize=function(){a.width=window.innerWidth;a.height=window.innerHeight-4};window.onresize();new Game(a)};
